<!DOCTYPE html>
<html metal:use-macro="main_template">
  
  <div metal:fill-slot="main_content" class="container">
    
    <div class="row" style="padding-bottom: 10px;">
      <div class="col-md-12">
        <button id="play-me" style="width: 8em;" class="btn btn-primary"><i
              class="fas fa-bullhorn"> </i> Listen</button>
        <button id="record-me" style="width: 8em;" class="btn btn-danger"><i
              class="fas fa-microphone"> </i> Record</button>
        <button id="reverse" style="width: 8em; display: none" class="btn btn-warning audiocontrol"><i
              class="fas fa-backward"> </i></button>
        <button id="forward" style="width: 8em; display: none" class="btn btn-warning audiocontrol"><i
              class="fas fa-forward"> </i></button>
      </div>
    </div>
    
    <div class="row">
      <div class="col-md-12">
        <div id="player" style="display: none" tal:condition="timings">
          <div id="karaoke-wrapper">
            <div id="karaoke-display"></div>
          </div>
        </div>
        <div id="status" style="padding-bottom: 5px;">0:00</div>
      </div>
      
    </div>
    
    <div class="row">
      <div class="col-md-6">
        <div class="panel panel-warning">
          <div class="panel-heading">
            <h3 class="panel-title">Microphone</h3>
          </div>
          <div class="panel-body">
            <div class="select">
              <select id="audioSource"></select>
            </div>
            <div class="mic-vol-blocks">
              <div class="mic-vol-block"></div>
              <div class="mic-vol-block"></div>
              <div class="mic-vol-block"></div>
              <div class="mic-vol-block"></div>
              <div class="mic-vol-block"></div>
              <div class="mic-vol-block"></div>
              <div class="mic-vol-block"></div>
              <div class="mic-vol-block"></div>
              <div class="mic-vol-block"></div>
              <div class="mic-vol-block"></div>
            </div>
            
            <div style="display: none">
              <input id="micLevel" type="range" min="0" max="1" value="1"
                     step="0.01"/>
              <label class="form-check-label" for="micLevel">
                  Mic Level
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-warning">
          <div class="panel-heading">
            <h3 class="panel-title">Timing Data</h3>
          </div>
          <div class="panel-body">
            <div class="well">
              <pre>${formatted_timings}</pre>
            </div>
          </div>
        </div>
      </div>
    </div>
         
    <div id="uploading-overlay">
      <div id="uploading-overlay-text">
        <i><b>Uploading</b></i>
        <div class="progress">
          <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%; min-width: 1em;" id="upload-progress">0%</div>
          <i class="fas fa-spinner fa-spin" id="afterupload-spinner"
             style="display:none;"> </i>
        </div>
      </div>
    </div>
    
  </div>

  <div metal:fill-slot="tail">
    <script type="text/javascript" src="${layout.static('yss.songs:static/ricekaraoke.js')}"></script>
    <script type="text/javascript" src="${layout.static('yss.songs:static/simplekaraokedisplay.js')}"></script>
    <script type="text/javascript" src="${layout.static('yss.songs:static/yssrecorder.js')}"></script>
    <script type="text/javascript">
     // karaoke and rtc_recorder are exported by yssrecorder
     kar = karaoke("${mp3_url}", ${timings});
     rtc_recorder(window, kar, null, "${request.resource_url(context, 'finish_retime')}");
    </script>
  </div>

</html>

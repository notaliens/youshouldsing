<div metal:use-macro="main_template">

  <div metal:fill-slot="main_content">

    <div class="col-md-8">

      <div class="panel panel-primary">

        <div class="panel-heading">
          ${title} by ${performer.title}
        </div>

        <div class="panel-body">

          <div class="container">

            <div id="recording-video" style="float: left">
              <video tal:condition="processed"
                     width="320" height="240" controls>
                <source src="${video_url}" type="video/ogg"/>
              </video>
              <p tal:condition="not processed">
                Processing... reload in a bit.
              </p>
            </div>

            <div id="recording-feedback"
                 style="float: left; padding-left: 2em">
              Likes: <span id="like-count">${likes}</span>
              <tal:if tal:condition="layout.can_like(context)">
                <a id="like-button" href="@@like" style="padding-left: 10px;"
                 ><i class="glyphicon glyphicon-thumbs-up"> </i></a>
                <script type="text/javascript">
                 $("#like-button").click(function () {
                    $.ajax('@@like')
                    .success(function(data) {
                        var counter = $('#like-count'),
                            thumb = $('#like-button');
                        counter.text(data['likes']);
                        thumb.hide();
                    })
                    .fail(function() {
                        alert('Failed to add like');
                    });
                    return false;
                 });
                </script>
              </tal:if>
            </div>
          </div>

          <div class="container">
            <div class="panel panel-default">
              <div class="panel-heading">
                Other recordings of this song
              </div>
              <div class="panel-body">
                <table tal:condition="batch|None" 
                       class="table table-striped table-condensed">

                  <tbody>
                    <tr tal:repeat="item recordings">
                      <td>${item.creator.photo_url()}</td>
                      <td>
                        <a href="${request.resource_url(item)}">${item.title}</a>
                      </td>
                      <td>${item.likes}</td>
                    </tr>
                  </tbody>
                </table>
                
              </div>
            </div>


          </div>

          <div class="container" 
               tal:condition="likes">
            <div class="panel panel-default">
              <div class="panel-heading">
                Like this recording:
              </div>
              <div class="panel-body">
                <table class="table table-striped table-condensed">

                  <tbody>
                    <tr tal:repeat="item liked_by">
                      <td><img src="${item.photo_url}"/></td>
                      <td>
                        <a href="${request.resource_url(item)}">${item.title}</a>
                      </td>
                    </tr>
                  </tbody>
                </table>
                
              </div>
            </div>

          </div>

        </div>
      </div>

    </div>

    <div class="col-md-4">

      <div class="panel panel-primary">

        <div class="panel-heading">
          Discussion
        </div>

        <div class="panel-body">

          <div class="container">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'youshouldsing'; // required: replace example with your forum shortname
                var disqus_id = '${context.__oid__}';
                var disqus_title = '${context.title}: ${context.performer.title}';
                var disqus_url = '${request.resource_url(context)}';

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

          </div>

        </div>

      </div>

    </div>

  </div>

</div>
